<!DOCTYPE html>
<html lang="en">
<head>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> # chatgpt
<title>CSS Template</title> 
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
* {
  box-sizing: border-box;
}

body {
  font-family: Arial, Helvetica, sans-serif;
}

header {
  background-color: #666;
  padding: 30px;
  text-align: center;
  font-size: 35px;
  color: white;
}

section {
  display:flex;
  flex-direction: row;
  background-color: #f1f1f1;
}

#researcherTable th {
  background-color: #af7a73; /* Change this to your preferred color */
  color: white; /* Optional: Changes text color to white for contrast */
}

#researcherTable td {
  background-color: #f9f9f9; /* Optional: Sets a different color for table rows */
}

#researcherTable {
  width: 90%;
  border-collapse: collapse;
}

#researcherTable th, #researcherTable td {
  padding: 8px;
  text-align: left;
}

.container {
  max-height: 300px;  /* adjust height as needed */
  overflow-y: auto;
  overflow-x: auto;
  border: 1px solid #ddd;
  padding-left: 5%;
  padding-right: 5%;
}

#grantTable th {
  background-color: #af7a73; /* Change this to your preferred color */
  color: white; /* Optional: Changes text color to white for contrast */
}

#grantTable td {
  background-color: #f9f9f9; /* Optional: Sets a different color for table rows */
}

#grantTable {
  width: 90%;
  border-collapse: collapse;
}

#grantTable th, #grantTable td {
  padding: 8px;
  text-align: left;
}

.container {
  max-height: 300px;  /* adjust height as needed */
  overflow-y: auto;
  overflow-x: auto;
  border: 1px solid #ddd;
  padding-left: 5%;
  padding-right: 5%;
}

section::after {
  content: "";
  display: table;
  clear: both;
}

footer {
  background-color: #777;
  padding: 10px;
  text-align: center;
  color: white;
}

@media (max-width: 600px) {
  nav, article {
    width: 100%;
    height: auto;
  }
}
</style>
</head>
<body>

<header>
  <h2>Grant Comparator</h2>
</header>

<section>
  
  <article>
  <br/>
  <form id="compareForm">
    <label for="researcherId">Enter Researcher ID:</label>
    <input type="number" id="researcherId" name="researcherId" required>
  </form>
  <button id="compareButton">Compare</button>
  <div id="comparison"></div>

  <h1>Add A Grant</h1>
  <div><button id="button-showCreateResearcher" onclick="showCreateResearcher()">Add a Grant</button><br/><br/></div>
  <h1>Researcher Table</h1>
  <div class="container">
    <table border="1" id="researcherTable">
          <tr>
                  <th>id</th>
                  <th>Title</th>
                  <th>Author</th>
                  <th>Year</th>
                  <th>Institution</th>
                  <th>Programme</th>
                  <th>Amount</th>
                  <th>Update</th>
                  <th>Delete</th>
          </tr>
  </table>
  <br/>
  </div>
  <p>Here's the full list of the grants used by the comparison tool. The information below has been pulled from the old SFI grant commitments file <a href="https://data.gov.ie/dataset/science-foundation-ireland-grants-commitments/resource/1dda5892-aeff-4588-a94f-b548984d9340">SFI grant commitments file</a> hosted on data.gov.ie. 
    However, if you think it's missing a grant, feel free to add it by using the "Add a Grant" button below. Similarily, if you think any of the data is wrong, you can also update it using the "Update" and "Delete" buttons on the table.</p>

  <br/>
  </div>
  <div id="createUpdateForm" style="display:none">
      <h2><span id="createLabel">Add a</span> <span id="updateLabel">Update this</span> Grant</h2>
      id <input type="text" name="id"><br/>
      Title <input type="text" name="title"><br/>
      Author <input type="text" name="author"><br/>
      Year <input type="text" name="year"><br/>
      Institution <input type="text" name="institution"><br/>
      Programme <input type="text" name="programme"><br/>
      Amount <input type="number" name="amount"><br/>
      <span><button id="button-doCreateResearcher" onclick="doCreateResearcher()">Add</button></span>
      <span><button id="button-doUpdateResearcher" onclick="doUpdateResearcher()">Update</button></span>
   </div>

</body>
<script>

// Researcher Table
  function showCreateResearcher(){
      document.getElementById("createUpdateForm").style.display = "block"
      document.getElementById("button-doCreateResearcher").style.display = "block"
      document.getElementById("button-doUpdateResearcher").style.display = "none"
      document.getElementById("createLabel").style.display = "inline"
      document.getElementById("updateLabel").style.display = "none"
      document.getElementById("button-showCreateResearcher").style.display = "none"
      document.getElementById("researcherTable").style.display = "none"
      
  }
  function showUpdateResearcher(buttonElement){
      document.getElementById("createUpdateForm").style.display = "block"
      document.getElementById("button-doCreateResearcher").style.display = "none"
      document.getElementById("button-doUpdateResearcher").style.display = "block"
      document.getElementById("createLabel").style.display = "none"
      document.getElementById("updateLabel").style.display = "inline"
      document.getElementById("button-showCreateResearcher").style.display = "none"
      document.getElementById("researcherTable").style.display = "none"

      rowElement= buttonElement.parentNode.parentNode
      researcher = getResearcherFromRow(rowElement)
      populateFormWithResearcher(researcher)
      
  }

  function showViewall(){
      document.getElementById("createUpdateForm").style.display = "none"
      document.getElementById("button-showCreateResearcher").style.display = "block"
      document.getElementById("researcherTable").style.display = "block"
      
  }
  function clearForm(){
      var form = document.getElementById('createUpdateForm')
      form.querySelector('input[name="id"]').disabled = false
      form.querySelector('input[name="id"]').value  =''
      form.querySelector('input[name="title"]').value=''
      form.querySelector('input[name="author"]').value=''
      form.querySelector('input[name="year"]').value=''
      form.querySelector('input[name="institution"]').value=''
      form.querySelector('input[name="programme"]').value=''
      form.querySelector('input[name="amount"]').value=''
  }
  
  function getResearcherFromForm(){
      var form = document.getElementById('createUpdateForm')
      var researcher = {}
    researcher.id = form.querySelector('input[name="id"]').value
    researcher.title = form.querySelector('input[name="title"]').value
    researcher.author = form.querySelector('input[name="author"]').value
    researcher.year = form.querySelector('input[name="year"]').value
    researcher.institution = form.querySelector('input[name="institution"]').value
    researcher.programme = form.querySelector('input[name="programme"]').value
    researcher.amount = form.querySelector('input[name="amount"]').value
      return researcher
  }
  function populateFormWithResearcher(researcher){
    var form = document.getElementById('createUpdateForm')
    form.querySelector('input[name="id"]').disabled = true
    form.querySelector('input[name="id"]').value  = researcher.id
    form.querySelector('input[name="title"]').value= researcher.title
    form.querySelector('input[name="author"]').value= researcher.author
    form.querySelector('input[name="year"]').value= researcher.year
    form.querySelector('input[name="institution"]').value= researcher.institution
    form.querySelector('input[name="programme"]').value= researcher.programme
    form.querySelector('input[name="amount"]').value= researcher.amount
}


  function addResearcherToTable(researcher){
      var tableElement = document.getElementById('researcherTable')
      var rowElement = tableElement.insertRow(-1)
      
      rowElement.setAttribute('id',researcher.id)
      
      var cell1 = rowElement.insertCell(0);
      cell1.innerHTML = researcher.id
      var cell2 = rowElement.insertCell(1);
      cell2.innerHTML = researcher.title
      var cell3 = rowElement.insertCell(2);
      cell3.innerHTML = researcher.author
      var cell3 = rowElement.insertCell(3);
      cell3.innerHTML = researcher.year
      var cell4 = rowElement.insertCell(4);
      cell4.innerHTML = researcher.institution
      var cell4 = rowElement.insertCell(5);
      cell4.innerHTML = researcher.programme
      var cell5= rowElement.insertCell(6);
      cell5.innerHTML = researcher.amount
      var cell6 = rowElement.insertCell(7);
      cell6.innerHTML = '<button onclick=showUpdateResearcher(this)>Update</button>'
      var cell7 = rowElement.insertCell(8);
      cell7.innerHTML = '<button onclick=doDelete(this)>Delete</button>'

  }
  function getResearcherFromRow(rowElement){
      var researcher ={}
      researcher.id  = rowElement.cells[0].firstChild.textContent
      researcher.title = rowElement.cells[1].firstChild.textContent
      researcher.author = rowElement.cells[2].firstChild.textContent
      researcher.year = rowElement.cells[3].firstChild.textContent
      researcher.institution = rowElement.cells[4].firstChild.textContent
      researcher.programme = rowElement.cells[5].firstChild.textContent
      researcher.amount = rowElement.cells[6].firstChild.textContent
      return researcher
  }
  function setResearcherInRow(rowElement, researcher){
      rowElement.cells[0].firstChild.textContent= researcher.id  
      rowElement.cells[1].firstChild.textContent= researcher.title 
      rowElement.cells[2].firstChild.textContent= researcher.author
      rowElement.cells[3].firstChild.textContent= researcher.year
      rowElement.cells[4].firstChild.textContent= researcher.institution
      rowElement.cells[5].firstChild.textContent= researcher.programme
      rowElement.cells[6].firstChild.textContent= researcher.amount
}

  function doCreateResearcher(){
      console.log("creating a researcher")
      researcher = getResearcherFromForm()
      createResearcher(convertDisplayResearcherToServerResearcher(researcher), processCreateResponse)
      console.log("About to create researcher:");
      console.log(getResearcherFromForm());
      console.log("Server payload:");
      console.log(JSON.stringify(convertDisplayResearcherToServerResearcher(getResearcherFromForm())));
  }

  function doUpdateResearcher(){
      researcher= getResearcherFromForm()
      console.log(researcher)
      var rowElement = document.getElementById(researcher.id)
      setResearcherInRow(rowElement, researcher)
      updateResearcher(convertDisplayResearcherToServerResearcher(researcher), doNothing)
      showViewall()
      clearForm()
  }
  function doDelete(buttonElement){
      console.log("in delete")
      var tableElement = document.getElementById('researcherTable')
      var rowElement = buttonElement.parentNode.parentNode;
      id = rowElement.getAttribute("id")
      console.log("deleting "+id)
      deleteResearcher(id, doNothing)

      index = rowElement.rowIndex
      tableElement.deleteRow(index);


  }

  function processGetAllResponseResearcher(result){
      console.log("in process")
      for (researcher of result){
          displayResearcher = {}
          displayResearcher.id = researcher.id
          displayResearcher.author = researcher.author
          displayResearcher.title = researcher.title
          displayResearcher.year = researcher.year
          displayResearcher.institution = researcher.institution
          displayResearcher.programme = researcher.programme
          displayResearcher.amount = researcher.amount
          addResearcherToTable(displayResearcher)
      }
  }
  function convertDisplayResearcherToServerResearcher(displayResearcher){
      serverResearcher = {}
      serverResearcher.id = displayResearcher.id
      serverResearcher.title = displayResearcher.title
      serverResearcher.author = displayResearcher.author
      serverResearcher.year = displayResearcher.year
      serverResearcher.institution = displayResearcher.institution
      serverResearcher.programme = displayResearcher.programme
      serverResearcher.amount = parseInt(displayResearcher.amount) // convert the string to an int
      return serverResearcher
  }
  function convertServerResearcherToDisplayResearcher(researcher){
      displayResearcher = {}
      displayResearcher.id = researcher.id
      displayResearcher.author = researcher.author
      displayResearcher.title = researcher.title
      displayResearcher.year = researcher.year
      displayResearcher.institution = researcher.institution
      displayResearcher.programme = researcher.programme
      displayResearcher.amount = researcher.amount
      return displayResearcher
  }
  function processCreateResponse(result){
      displayResearcher = convertServerResearcherToDisplayResearcher(result)
      addResearcherToTable(displayResearcher)
      showViewall()
      clearForm()
  }

  function doNothing(result){
      console.log("nothing:"+result)
      return "done"
  }

    getAllResearcher(processGetAllResponseResearcher)


// Researcher Ajax calls

function getAllResearcher(callback) {
    $.ajax({
        url: '/researcher',
        method: 'GET',
        dataType: 'json',
        success: callback
    });
}

function createResearcher(researcher, callback) {
    $.ajax({
        url: '/researcher',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(researcher),
        success: callback
    });
}

function updateResearcher(researcher, callback) {
    $.ajax({
        url: '/researcher/' + researcher.id,
        method: 'PUT',
        contentType: 'application/json',
        data: JSON.stringify(researcher),
        success: callback
    });
}

function deleteResearcher(id, callback) {
    $.ajax({
        url: '/researcher/' + id,
        method: 'DELETE',
        success: callback
    });
}


// Comparison functions

// Chatgpt - Why is this comparison button not working?
$('#compareButton').on('click', function() {
    var researcherId = $('#researcherId').val();
    if (researcherId) {
        comparison(researcherId);
    } else {
        $('#comparison').text('Please enter a valid Researcher ID.');
    }
});

function comparison(researcherId) {
    $.ajax({
        url: '/compare/' + researcherId,
        method: 'GET',
        success: function(data) {
            $('#comparison').html(
              '<h3>Researcher Grant Analysis</h3>' +
              'This grant was ' + data.comparison_overall + ' than the overall average SFI grant awarded (€'+ data.average_grant_amount +')<br>' +
              'In the year this grant was awarded, it was ' + data.comparison_year + ' than the average SFI grant awarded (€'+ data.year_average+')<br>'+
              'When it comes to grants awarded to this instituions this grant was ' + data.comparison_institution + ' than the average SFI grant awarded (€'+ data.institution_average +')<br>'+
              'Compared to the average grant in this programme, this grant was ' + data.comparison_programme + ' than average SFI grant awarded (€' + data.programme_average +')<br>'         
              );
          },

        error: function() {
            $('#comparison').text('No researcher ID match.');
        }
    });
}

</script>

</section>

<footer>
  <p>This website is a personal project. If you have any other questions, feel free to contact me at my github account (NeilTynan).</p>
</footer>

</body>
</html>