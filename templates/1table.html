<!DOCTYPE html>
<html lang="en">
<head>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> # chatgpt
<title>CSS Template</title> 
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
* {
  box-sizing: border-box;
}

body {
  font-family: Arial, Helvetica, sans-serif;
}

header {
  background-color: #666;
  padding: 30px;
  text-align: center;
  font-size: 35px;
  color: white;
}

nav {
  float: left;
  width: 20%;
  height: 300px;
  background: #ccc;
  padding: 20px;
}

nav ul {
  list-style-type: none;
  padding: 0;
}

article {
  float: left;
  padding: 20px;
  width: 80%;
  background-color: #f1f1f1;
  height: 300px;
}

#grantTable {
  width: 100%;
  border-collapse: collapse;
}

#grantTable th, #grantTable td {
  padding: 8px;
  text-align: left;
}

section::after {
  content: "";
  display: table;
  clear: both;
}

footer {
  background-color: #777;
  padding: 10px;
  text-align: center;
  color: white;
}

@media (max-width: 600px) {
  nav, article {
    width: 100%;
    height: auto;
  }
}
</style>
</head>
<body>

<header>
  <h2>Grant Comparator</h2>
</header>

<section>
  <nav>
    <ul>
      <li><a href="#">Grant Table</a></li>
      <li><a href="#">Add/Update a Grant</a></li>
      <li><a href="#">Analysis</a></li>
    </ul>
  </nav>
  
  <article>
  <h1>Books</h1>
  <div><button id="button-showCreate" onclick="showCreate()">Create a book</button><br/><br/></div>
  <div>
      <table border="1" id="grantTable">
          <tr>
                  <th>id</th>
                  <th>Title</th>
                  <th>Author</th>
                  <th>Institution</th>
                  <th>Amount</th>
                  <th>Delete</th>
          </tr>
  </table>
  <br/>
  </div>
  <div id="createUpdateForm" style="display:none">
      <!-- spans are like divs but do not go onto a new line -->
      <h2><span id="createLabel">Create a</span> <span id="updateLabel">Update this</span> Book</h2>
      id <input type="text" name="id"><br/>
      Title <input type="text" name="title"><br/>
      Author <input type="text" name="author"><br/>
      Institution <input type="text" name="institution"><br/>
      Amount <input type="number" name="amount"><br/>

      <span><button id="button-doCreate" onclick="doCreate()">Create</button></span>
 <span><button id="button-doUpdate" onclick="doUpdate()">Update</button></span>
       <!-- "display:none" will make it hidden-->


  </div>
  
</body>
<script>
  //console.log("hello world")
  function showCreate(){
      document.getElementById("createUpdateForm").style.display = "block"
      
      document.getElementById("button-doCreate").style.display = "block"
      document.getElementById("button-doUpdate").style.display = "none"
      document.getElementById("createLabel").style.display = "inline"
      document.getElementById("updateLabel").style.display = "none"

      document.getElementById("button-showCreate").style.display = "none"
      document.getElementById("grantTable").style.display = "none"
      
  }
  function showUpdate(buttonElement){
      document.getElementById("createUpdateForm").style.display = "block"
     
      document.getElementById("button-doCreate").style.display = "none"
      document.getElementById("button-doUpdate").style.display = "block"
      document.getElementById("createLabel").style.display = "none"
      document.getElementById("updateLabel").style.display = "inline"

      document.getElementById("button-showCreate").style.display = "none"
      document.getElementById("grantTable").style.display = "none"

      rowElement= buttonElement.parentNode.parentNode
      grant = getGrantFromRow(rowElement)
      //console.log("updating")
      //console.log(book)
      populateFormWithGrant(grant)
      
  }
  function showViewall(){
      document.getElementById("createUpdateForm").style.display = "none"
     
      document.getElementById("button-showCreate").style.display = "block"
      document.getElementById("grantTable").style.display = "block"
      
  }
  function clearForm(){
      var form = document.getElementById('createUpdateForm')

      form.querySelector('input[name="id"]').disabled = false
      form.querySelector('input[name="id"]').value  =''
      form.querySelector('input[name="author"]').value=''
      form.querySelector('input[name="title"]').value=''
      form.querySelector('input[name="institution"]').value=''
      form.querySelector('input[name="amount"]').value=''
  }
  
  function getGrantFromForm(){
      var form = document.getElementById('createUpdateForm')

       var grant = {}
    grant.id = form.querySelector('input[name="id"]').value
    grant.title = form.querySelector('input[name="title"]').value
    grant.author = form.querySelector('input[name="author"]').value
    grant.institution = form.querySelector('input[name="institution"]').value
    grant.amount = form.querySelector('input[name="amount"]').value
    //console.log(JSON.stringify(book))
      return grant
  }
  function populateFormWithGrant(grant){
     var form = document.getElementById('createUpdateForm')
    form.querySelector('input[name="id"]').disabled = true
     form.querySelector('input[name="id"]').value  = grant.id
     form.querySelector('input[name="title"]').value= grant.title
    form.querySelector('input[name="author"]').value= grant.author
    form.querySelector('input[name="institution"]').value= grant.institution
    form.querySelector('input[name="amount"]').value= grant.amount
}


  function addGrantToTable(grant){
      var tableElement = document.getElementById('grantTable')
      var rowElement = tableElement.insertRow(-1)
      
      rowElement.setAttribute('id',grant.id)
      
      var cell1 = rowElement.insertCell(0);
      cell1.innerHTML = grant.id
      var cell2 = rowElement.insertCell(1);
      cell2.innerHTML = grant.title
      var cell3 = rowElement.insertCell(2);
      cell3.innerHTML = grant.author
      var cell4 = rowElement.insertCell(3);
      cell4.innerHTML = grant.institution
      var cell5= rowElement.insertCell(4);
      cell5.innerHTML = grant.amount
      var cell6 = rowElement.insertCell(5);
      cell6.innerHTML = '<button onclick="showUpdate(this)">Update</button>'
      var cell7 = rowElement.insertCell(6);
      cell7.innerHTML = '<button onclick=doDelete(this)>delete</button>'

  }
  function getGrantFromRow(rowElement){
      var grant ={}
      grant.id  = rowElement.cells[0].firstChild.textContent
      grant.title = rowElement.cells[1].firstChild.textContent
      grant.author = rowElement.cells[2].firstChild.textContent
      grant.institution = rowElement.cells[3].firstChild.textContent
      grant.amount = rowElement.cells[4].firstChild.textContent
      return grant
  }
  function setGrantInRow(rowElement, grant){
      rowElement.cells[0].firstChild.textContent= grant.id  
      rowElement.cells[1].firstChild.textContent= grant.title 
      rowElement.cells[2].firstChild.textContent= grant.author
      rowElement.cells[3].firstChild.textContent= grant.institution
      rowElement.cells[4].firstChild.textContent= grant.amount
}

  function doCreate(){
      console.log("creating a grant")
      grant = getGrantFromForm()
      //console.log(grant)
      // I need to wait until I get the id from the server before adding this to the table
      // so  I put that code in the callback function
      createGrant(convertDisplayGrantToServerGrant(grant), processCreateResponse)
      console.log("About to create grant:");
  console.log(getGrantFromForm());
  console.log("Server payload:");
  console.log(JSON.stringify(convertDisplayGrantToServerGrant(getGrantFromForm())));
     
  }
  function doUpdate(){
      grant= getGrantFromForm()
      console.log(grant)
      var rowElement = document.getElementById(grant.id)
      setGrantInRow(rowElement, grant)
      // now I am updating on the server
      // yes there is a change that it will be updated on the table and not the server
      updateGrant(convertDisplayGrantToServerGrant(grant), doNothing)
     
      showViewall()
      clearForm()
  }
  function doDelete(buttonElement){
      console.log("in delete")
      var tableElement = document.getElementById('grantTable')
      var rowElement = buttonElement.parentNode.parentNode;
      // I need the grant id
      id = rowElement.getAttribute("id")
      console.log("deleting "+id)
      deleteGrant(id, doNothing)
     

      index = rowElement.rowIndex
      tableElement.deleteRow(index);


  }

  // populate the table
  function processGetAllResponse(result){
      console.log("in process")
      //console.log(result)
      for (grant of result){
          //console.log(grant)
          // issue the format of the grant object is different from lab06.02
          // there are two solutions change the grant object in lan06.02 to have capitals 
          // or convert
          displayGrant = {}
          displayGrant.id = grant.id
          displayGrant.author = grant.author
          displayGrant.title = grant.title
          displayGrant.institution = grant.institution
          displayGrant.amount = grant.amount
          // you can now pass it to addGrantToTable
          //console.log(displayGrant)
          addGrantToTable(displayGrant)
      }
  }
  function convertDisplayGrantToServerGrant(displayGrant){
      serverGrant = {}
      serverGrant.id = displayGrant.id
      serverGrant.title = displayGrant.title
      serverGrant.author = displayGrant.author
      serverGrant.institution = displayGrant.institution
      serverGrant.amount = parseInt(displayGrant.amount) // convert the string to an int
      return serverGrant
  }
  function convertServerGrantToDisplayGrant(grant){
      displayGrant = {}
      displayGrant.id = grant.id
      displayGrant.author = grant.author
      displayGrant.title = grant.title
      displayGrant.institution = grant.institution
      displayGrant.amount = grant.amount
      return displayGrant
  }
  function processCreateResponse(result){
      displayGrant = convertServerGrantToDisplayGrant(result)
      addGrantToTable(displayGrant)
      showViewall()
      clearForm()
  }
  // I should set this as the default function for the callback
  function doNothing(result){
      console.log("nothing:"+result)
      return "done"
  }

   getAll(processGetAllResponse)


function getAll(callback) {
    $.ajax({
        url: '/grants',
        method: 'GET',
        dataType: 'json',
        success: callback
    });
}

function createGrant(grant, callback) {
    $.ajax({
        url: '/grants',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(grant),
        success: callback
    });
}

function updateGrant(grant, callback) {
    $.ajax({
        url: '/grants/' + grant.id,
        method: 'PUT',
        contentType: 'application/json',
        data: JSON.stringify(grant),
        success: callback
    });
}

function deleteGrant(id, callback) {
    $.ajax({
        url: '/grants/' + id,
        method: 'DELETE',
        success: callback
    });
}

</script>

</section>

<footer>
  <p>Footer</p>
</footer>

</body>
</html>